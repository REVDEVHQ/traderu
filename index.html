<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>TRADER U SUPER BOT</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap');

    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root{
      --bg:#0a0a0a;
      --panel-bg:#111;
      --border:#333;
      --text:#fff;
      --text-dim:#aaa;

      --accent:#ff9500;
      --accent-hover:#ffaa33;

      --green:#00ff00;
      --red:#ff3333;

      --mobile-topbar: 60px;
      --mobile-tabs: 50px;
      --mobile-feed: 55px;
      --mobile-safe-bottom: env(safe-area-inset-bottom, 0px);
    }

    body{
      font-family:'Roboto Mono', monospace;
      background:var(--bg);
      color:var(--text);
      overflow:hidden;
    }

    /* Scanlines only */
    body::before{
      content:"";
      position:fixed;
      inset:0;
      background:repeating-linear-gradient(
        to bottom,
        rgba(255,255,255,0.02),
        rgba(255,255,255,0.02) 1px,
        transparent 1px,
        transparent 3px
      );
      opacity:0.08;
      pointer-events:none;
      z-index:9999;
    }

    .screen-flash{
      position:fixed;
      inset:0;
      background:var(--accent);
      opacity:0;
      pointer-events:none;
      z-index:9998;
    }
    .screen-flash.active{ animation:screenFlash .3s ease-out; }
    @keyframes screenFlash{
      0%,100%{opacity:0;}
      50%{opacity:0.12;}
    }

    @keyframes glitchHover{
      0%{text-shadow:2px 0 var(--accent),-2px 0 cyan;}
      25%{text-shadow:-2px 0 var(--accent),2px 0 cyan;}
      50%{text-shadow:2px 0 cyan,-2px 0 var(--accent);}
      75%{text-shadow:-2px 0 cyan,2px 0 var(--accent);}
      100%{text-shadow:0 0 var(--accent);}
    }

    /* Welcome Screen */
    #welcome-screen{
      position:fixed;
      inset:0;
      background:#000;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      z-index:10000;
      transition:opacity .5s ease;
    }
    #welcome-screen.hidden{
      opacity:0;
      pointer-events:none;
    }
    .welcome-logo{
      font-size:3.5rem;
      font-weight:700;
      color:var(--accent);
      margin-bottom:10px;
      letter-spacing:8px;
      text-align:center;
    }
    .welcome-subtitle{
      font-size:1.1rem;
      color:#666;
      margin-bottom:40px;
      letter-spacing:3px;
      text-align:center;
    }
    .loading-bar{
      width:400px;
      height:4px;
      background:#222;
      margin-bottom:30px;
      overflow:hidden;
      max-width:80vw;
    }
    .loading-progress{
      height:100%;
      background:var(--accent);
      width:0%;
      animation:loadProgress 2s ease-out forwards;
    }
    @keyframes loadProgress{ to{width:100%;} }

    .enter-btn{
      padding:15px 50px;
      background:transparent;
      border:2px solid var(--accent);
      color:var(--accent);
      font-family:inherit;
      font-size:1rem;
      font-weight:700;
      cursor:pointer;
      letter-spacing:3px;
      opacity:0;
      animation:fadeInBtn .5s ease 2s forwards;
      transition:all .3s;
    }
    @keyframes fadeInBtn{ to{opacity:1;} }
    .enter-btn:hover{ background:var(--accent); color:#000; }

    /* Main Layout */
    #terminal-container{
      display:grid;
      grid-template-columns:380px 1fr 420px;
      grid-template-rows:60px calc(100vh - 90px);
      height:100vh;
      gap:0;
    }

    /* Top Bar */
    #top-bar{
      grid-column:1 / -1;
      background:var(--panel-bg);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 25px;
      border-bottom:2px solid var(--border);
    }
    .terminal-title{
      font-size:1.3rem;
      font-weight:700;
      color:var(--accent);
      letter-spacing:5px;
      cursor:pointer;
      user-select:none;
      white-space:nowrap;
    }
    .terminal-title:hover{ animation:glitchHover .5s ease; }

    .top-right{
      display:flex;
      align-items:center;
      gap:20px;
    }

    .social-links{
      display:flex;
      gap:15px;
      align-items:center;
    }
    .social-links a{
      font-size:1.4rem;
      font-weight:900;
      transition:all .3s;
      text-decoration:none;
      font-family:'Roboto Mono', monospace;
      user-select:none;
    }
    .social-links a:hover{ transform:scale(1.3); }
    .social-links a.youtube{ color:#ff0000; }
    .social-links a.youtube:hover{ filter:brightness(1.3); }
    .social-links a.tiktok{ color:#00f2ea; }
    .social-links a.tiktok:hover{ filter:brightness(1.3); }
    .social-links a.instagram{
      background:linear-gradient(45deg,#f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    .social-links a.instagram:hover{ filter:brightness(1.3); }

    .theme-switcher{ display:flex; gap:8px; }
    .theme-btn{
      width:28px;
      height:28px;
      border:2px solid #333;
      cursor:pointer;
      transition:all .3s;
      position:relative;
    }
    .theme-btn:hover{
      transform:scale(1.15);
      border-color:var(--text);
    }
    .theme-btn.active{
      border-color:var(--text);
      box-shadow:0 0 10px currentColor;
    }

    .status-indicator{
      display:flex;
      align-items:center;
      gap:10px;
      font-size:.8rem;
      color:#888;
      user-select:none;
    }
    .status-dot{
      width:10px;
      height:10px;
      background:var(--green);
      border-radius:50%;
      animation:pulse 2s infinite;
    }
    @keyframes pulse{
      0%,100%{opacity:1;}
      50%{opacity:.4;}
    }

    /* Left Panel - Education Terminal */
    #left-panel{
      background:var(--panel-bg);
      display:flex;
      flex-direction:column;
      border-right:2px solid var(--border);
      overflow:hidden;
      min-height:0;
    }
    .panel-header{
      padding:12px 20px;
      background:#0a0a0a;
      border-bottom:2px solid var(--border);
      font-size:.75rem;
      font-weight:700;
      color:#888;
      letter-spacing:2px;
      flex-shrink:0;
      user-select:none;
    }
    #command-output{
      flex:1;
      overflow-y:auto;
      overflow-x:hidden;
      padding:20px;
      font-size:.85rem;
      line-height:2;
      min-height:0;
      -webkit-overflow-scrolling:touch;
      overscroll-behavior:contain;
      touch-action:pan-y;
    }
    #command-output::-webkit-scrollbar{ width:8px; }
    #command-output::-webkit-scrollbar-thumb{ background:#333; border-radius:4px; }
    .cmd-line{ margin-bottom:10px; opacity:0; animation:slideIn .4s ease forwards; }
    @keyframes slideIn{ from{opacity:0; transform:translateY(5px);} to{opacity:1; transform:translateY(0);} }
    .cmd-prompt{ color:var(--accent); font-weight:700; }
    .cmd-text{ color:#bbb; }
    .cmd-success{ color:var(--green); font-weight:700; text-shadow:0 0 10px var(--green); }
    .cmd-warning{ color:#ffaa00; font-weight:700; text-shadow:0 0 10px rgba(255,170,0,.5); }

    #command-input-area{
      padding:15px 20px;
      background:#0a0a0a;
      border-top:2px solid var(--border);
      display:flex;
      gap:10px;
      flex-shrink:0;
    }
    #command-input{
      flex:1;
      background:#1a1a1a;
      border:1px solid #333;
      padding:10px;
      color:var(--text);
      font-family:inherit;
      font-size:.85rem;
    }
    #command-input:focus{ outline:none; border-color:var(--accent); }

    /* Center Panel - Neural Network */
    #center-panel{
      background:var(--panel-bg);
      position:relative;
      overflow:hidden;
      min-height:0;
    }
    #neural-network{ width:100%; height:100%; position:relative; touch-action:none; }

    .neural-label{
      position:absolute;
      top:20px;
      left:50%;
      transform:translateX(-50%);
      padding:8px 20px;
      background:rgba(255,149,0,.2);
      border:2px solid var(--accent);
      font-size:.75rem;
      font-weight:700;
      letter-spacing:3px;
      z-index:10;
      user-select:none;
      white-space:nowrap;
    }

    /* SINGLE SOURCE OF TRUTH FOR NODES (no duplicate .neural-node) */
    .neural-node{
      position:absolute;
      width:50px;
      height:50px;
      border-radius:50%;
      border:2px solid var(--accent);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:.5rem;
      font-weight:700;
      cursor:grab;
      transition:box-shadow .25s, transform .25s;
      background:rgba(255,149,0,.15);
      box-shadow:0 0 20px rgba(255,149,0,.4);
      text-align:center;
      line-height:1.1;
      color:#fff;
      z-index:10;
      user-select:none;
      touch-action:none;
    }
    .neural-node:hover{
      transform:scale(1.10);
      z-index:100;
      box-shadow:0 0 35px var(--accent);
    }
    .neural-node.dragging{
      cursor:grabbing;
      z-index:1000;
      box-shadow:0 0 40px var(--accent);
      transform:scale(1.05);
    }
    .neural-node.core{
      width:70px;
      height:70px;
      font-size:.6rem;
      background:rgba(255,149,0,.25);
      box-shadow:0 0 30px rgba(255,149,0,.6);
    }
    .neural-node.active{ animation:nodePulse 2s ease-in-out infinite; }
    @keyframes nodePulse{
      0%,100%{ box-shadow:0 0 20px rgba(255,149,0,.4); }
      50%{ box-shadow:0 0 40px var(--accent); }
    }

    .synapse{
      position:absolute;
      height:1.5px;
      background:var(--accent);
      transform-origin:left center;
      opacity:.4;
      box-shadow:0 0 8px var(--accent);
      z-index:1;
      pointer-events:none;
    }
    .synapse.firing{ animation:synapseFire 1.5s ease-in-out infinite; }
    .synapse.core-connection{
      height:2px;
      opacity:.6;
      box-shadow:0 0 12px var(--accent);
    }
    @keyframes synapseFire{
      0%,100%{ opacity:.4; }
      50%{ opacity:1; height:2.5px; }
    }

    .neural-stats{
      position:absolute;
      bottom:15px;
      left:15px;
      right:15px;
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      z-index:5;
      pointer-events:none;
    }
    .neural-stat{
      padding:10px 12px;
      background:rgba(255,149,0,.15);
      border:2px solid rgba(255,149,0,.5);
      font-size:.65rem;
      font-weight:700;
      text-transform:uppercase;
      letter-spacing:1px;
      color:#ccc;
      backdrop-filter:blur(5px);
    }
    .stat-value{
      color:var(--accent);
      font-size:1rem;
      display:block;
      margin-top:5px;
    }

    /* Right Panel - Bot Chat */
    #right-panel{
      background:var(--panel-bg);
      display:flex;
      flex-direction:column;
      border-left:2px solid var(--border);
      overflow:hidden;
      min-height:0;
    }
    #bot-chat{
      flex:1;
      overflow-y:auto;
      overflow-x:hidden;
      padding:20px;
      display:flex;
      flex-direction:column;
      gap:15px;
      min-height:0;
      -webkit-overflow-scrolling:touch;
      overscroll-behavior:contain;
      touch-action:pan-y;
    }
    #bot-chat::-webkit-scrollbar{ width:8px; }
    #bot-chat::-webkit-scrollbar-thumb{ background:#333; border-radius:4px; }
    .bot-message{
      padding:15px;
      background:#1a1a1a;
      border-left:4px solid var(--accent);
      font-size:.9rem;
      line-height:1.8;
      animation:slideIn .3s ease;
      word-break:break-word;
    }
    .bot-message img{
      max-width:100%;
      margin:15px 0;
      border:2px solid var(--accent);
      border-radius:4px;
    }
    .bot-message strong{ color:var(--accent); }

    .message-actions{
      display:flex;
      gap:10px;
      margin-top:12px;
      flex-wrap:wrap;
    }
    .action-btn{
      padding:8px 15px;
      background:transparent;
      border:1px solid #555;
      color:#aaa;
      font-family:inherit;
      font-size:.75rem;
      cursor:pointer;
      transition:all .3s;
    }
    .action-btn:hover{
      border-color:var(--accent);
      color:var(--accent);
      background:rgba(255,149,0,.1);
    }

    #bot-input-area{
      padding:15px 20px;
      background:#0a0a0a;
      border-top:2px solid var(--border);
      flex-shrink:0;
    }
    #bot-input{
      width:100%;
      background:#1a1a1a;
      border:1px solid #333;
      padding:12px;
      color:var(--text);
      font-family:inherit;
      font-size:.85rem;
      margin-bottom:10px;
    }
    #bot-input:focus{ outline:none; border-color:var(--accent); }

    #bot-send{
      width:100%;
      padding:12px;
      background:var(--accent);
      border:none;
      color:#000;
      font-family:inherit;
      font-size:.85rem;
      font-weight:700;
      cursor:pointer;
      letter-spacing:1px;
      transition:all .3s;
    }
    #bot-send:hover{ background:var(--accent-hover); }

    /* Data Feed */
    .data-feed{
      position:fixed;
      bottom:0;
      left:0;
      right:0;
      padding:10px 20px;
      background:#0a0a0a;
      border-top:2px solid var(--border);
      font-size:.75rem;
      display:flex;
      justify-content:space-around;
      z-index:9997;
      user-select:none;
    }
    .feed-item{ display:flex; gap:8px; }
    .feed-label{ color:#666; }
    .feed-value{ color:var(--green); font-weight:700; }

    /* Mobile tabs */
    #mobile-tabs{ display:none; }

    @media (max-width: 768px){
      body{ padding-bottom: env(safe-area-inset-bottom); }

      #terminal-container{
        grid-template-columns:1fr;
        grid-template-rows: var(--mobile-topbar) var(--mobile-tabs) 1fr;
        height:100vh;
        overflow:hidden;
      }

      #mobile-tabs{
        display:flex;
        grid-column:1 / -1;
        align-items:center;
        justify-content:space-around;
        gap:8px;
        padding:10px;
        background:#0a0a0a;
        border-bottom:2px solid var(--border);
        z-index:9996;
      }

      .mobile-tab{
        flex:1;
        padding:12px 8px;
        background:transparent;
        border:1px solid #333;
        color:#bbb;
        font-family:inherit;
        font-size:.75rem;
        font-weight:700;
        letter-spacing:2px;
        cursor:pointer;
        transition:all .2s ease;
      }
      .mobile-tab.active{
        border-color:var(--accent);
        color:var(--accent);
        background:rgba(255,149,0,.1);
      }

      #left-panel, #right-panel, #center-panel{
        grid-column:1 / -1;
        border:none;
        height: calc(100vh - var(--mobile-topbar) - var(--mobile-tabs) - var(--mobile-feed));
        overflow:hidden;
        min-height:0;
        position:relative;
      }

      #left-panel, #right-panel, #center-panel{ display:none; }
      #left-panel.active, #right-panel.active{ display:flex; flex-direction:column; }
      #center-panel.active{ display:block; }

      .panel-header{ padding:10px 15px; font-size:.7rem; }

      #command-output, #bot-chat{
        padding:15px;
        padding-bottom:20px;
      }

      #command-input, #bot-input{ font-size:16px; padding:12px; }

      #bot-send{ padding:14px; font-size:16px; }

      .bot-message{ padding:12px; font-size:.85rem; line-height:1.6; }
      .message-actions{ gap:8px; }
      .action-btn{ padding:8px 12px; font-size:.7rem; }

      .cmd-line{ margin-bottom:8px; font-size:.8rem; line-height:1.5; }

      .neural-node{
        width:45px; height:45px; font-size:.45rem;
      }
      .neural-node.core{
        width:60px; height:60px; font-size:.5rem;
      }

      .neural-stats{
        gap:8px;
        bottom:10px; left:10px; right:10px;
      }
      .neural-stat{
        font-size:.6rem;
        padding:8px 10px;
      }
      .stat-value{ font-size:.85rem; }

      .neural-label{
        font-size:.65rem;
        padding:6px 12px;
        top:10px;
      }

      .top-right{ gap:12px; }
      .social-links{ gap:10px; }
      .social-links a{ font-size:1.2rem; }
      .theme-btn{ width:24px; height:24px; }

      .data-feed{
        height:var(--mobile-feed);
        font-size:.65rem;
        padding:8px 10px;
        padding-bottom:max(8px, env(safe-area-inset-bottom));
        flex-wrap:nowrap;
        gap:8px;
        overflow-x:auto;
        display:flex;
        align-items:center;
      }
      .feed-item{ flex-shrink:0; }

      .terminal-title{ font-size:.9rem; letter-spacing:3px; }

      #command-output::-webkit-scrollbar,
      #bot-chat::-webkit-scrollbar{ width:6px; }
      #command-output::-webkit-scrollbar-thumb,
      #bot-chat::-webkit-scrollbar-thumb{ background:#444; border-radius:3px; }
    }
  </style>
</head>

<body>
  <div id="welcome-screen">
    <div class="welcome-logo">TRADER U SUPER BOT</div>
    <div class="welcome-subtitle">MEME COIN TRADING INTELLIGENCE</div>
    <div class="loading-bar"><div class="loading-progress"></div></div>
    <button class="enter-btn" onclick="enterTerminal()">ENTER SYSTEM</button>
  </div>

  <div id="terminal-container" style="opacity:0;">
    <div class="screen-flash" id="screen-flash"></div>

    <div id="top-bar">
      <div class="terminal-title" title="Toggle Brain Mode (Orbit/Sandbox)">TRADER U SUPER BOT</div>
      <div class="top-right">
        <div class="social-links" id="social-links">
          <a href="#" target="_blank" title="YouTube" class="youtube" id="yt-link">Y</a>
          <a href="#" target="_blank" title="TikTok" class="tiktok" id="tt-link">T</a>
          <a href="#" target="_blank" title="Instagram" class="instagram" id="ig-link">I</a>
        </div>

        <div class="theme-switcher">
          <div class="theme-btn active" style="background:#ff9500;" onclick="changeTheme('#ff9500', this)" title="Orange"></div>
          <div class="theme-btn" style="background:#00ff00;" onclick="changeTheme('#00ff00', this)" title="Green"></div>
          <div class="theme-btn" style="background:#00aaff;" onclick="changeTheme('#00aaff', this)" title="Blue"></div>
          <div class="theme-btn" style="background:#ff00ff;" onclick="changeTheme('#ff00ff', this)" title="Purple"></div>
        </div>

        <div class="status-indicator">
          <div class="status-dot"></div>
          <span>LIVE</span>
        </div>
      </div>
    </div>

    <!-- MOBILE TAB BAR -->
    <div id="mobile-tabs">
      <button class="mobile-tab" data-view="terminal">TERMINAL</button>
      <button class="mobile-tab active" data-view="brain">BRAIN</button>
      <button class="mobile-tab" data-view="bot">BOT</button>
    </div>

    <div id="left-panel">
      <div class="panel-header">EDUCATION TERMINAL</div>
      <div id="command-output"></div>
      <div id="command-input-area">
        <input type="text" id="command-input" placeholder="Type 'help' for commands..." />
      </div>
    </div>

    <div id="center-panel">
      <div class="neural-label">TRADER U NEURAL NETWORK</div>
      <div id="neural-network"></div>
      <div class="neural-stats">
        <div class="neural-stat">Neural Nodes<span class="stat-value">19</span></div>
        <div class="neural-stat">Synapses<span class="stat-value" id="synapse-count">0</span></div>
        <div class="neural-stat">Knowledge Docs<span class="stat-value" id="doc-count">0</span></div>
        <div class="neural-stat">Status<span class="stat-value" id="status-text">LOADING</span></div>
      </div>
    </div>

    <div id="right-panel">
      <div class="panel-header">TRADER U BOT</div>
      <div id="bot-chat"></div>
      <div id="bot-input-area">
        <input type="text" id="bot-input" placeholder="Ask me anything about trading..." />
        <button id="bot-send">SEND</button>
      </div>
    </div>
  </div>

  <div class="data-feed" style="opacity:0;" id="data-feed">
    <div class="feed-item"><span class="feed-label">BTC:</span><span class="feed-value">$95,284</span></div>
    <div class="feed-item"><span class="feed-label">ETH:</span><span class="feed-value">$3,421</span></div>
    <div class="feed-item"><span class="feed-label">SOL:</span><span class="feed-value">$147</span></div>
    <div class="feed-item"><span class="feed-label">MCAP:</span><span class="feed-value">$3.2T</span></div>
    <div class="feed-item"><span class="feed-label">24H VOL:</span><span class="feed-value">$127B</span></div>
  </div>

  <script>
    // ============================================
    // CONTENT URL - CHANGE THIS TO YOUR JSON FILE
    // ============================================
    const CONTENT_URL = './content.json';

    // ============================================
    // LOCAL STORAGE KEYS
    // ============================================
    const BRAIN_STORAGE_KEY = "traderu_brain_v1";
    const STATS_STORAGE_KEY = "traderu_stats_v1";

    // ============================================
    // BRAIN MODE
    // orbit = orbiting nodes (drag snaps back)
    // sandbox = nodes stay where dropped (saved)
    // ============================================
    let BRAIN_MODE = "sandbox"; // change to "orbit" if you want orbit as default

    // ============================================
    // LOADED CONTENT (from JSON)
    // ============================================
    let facts = {};
    let knowledgeBase = {};
    let education = { quotes:[], tips:[], warnings:[], checklist:[] };

    // ============================================
    // FALLBACK CONTENT (if JSON fails)
    // ============================================
    function applyFallbackContent() {
      facts = facts && Object.keys(facts).length ? facts : {
        traderUYoutube: "#",
        traderUTikTok: "#",
        traderUInstagram: "#"
      };

      knowledgeBase = knowledgeBase && Object.keys(knowledgeBase).length ? knowledgeBase : {
        liquidity: {
          title: "Liquidity + LP Locks (What It Means)",
          content:
`LP lock usually means the LP tokens are time-locked so the creator canâ€™t instantly remove liquidity (â€œpull LPâ€). Good signal â€” NOT a guarantee.

âœ… Protects against:
â€¢ Simple pull-liquidity rugs (instant LP removal)

âŒ Does NOT protect against:
â€¢ Dev dumping supply into LP
â€¢ Bundled insiders farming you
â€¢ Fake lock screenshots/pages
â€¢ Tiny / thin liquidity (still easy to nuke)
â€¢ Malicious token permissions (chain-dependent)

Verify fast:
1) Locker + unlock time is real
2) Lock tx matches the pool
3) Liquidity size is meaningful vs MC
4) Top holders / bundles look clean
5) Test small buy/sell if possible`,
          actions: ["LP locks", "Volume check", "Bundle detection", "Risk rules"]
        },
        rugpull: { title:"Rug Detection", content:"(Add your rug guide in content.json)", actions:["Bundle detection","Volume check","Risk rules"] },
        risk: { title:"Risk Management", content:"(Add your risk rules in content.json)", actions:["Risk rules","Settings"] },
        referrals: { title:"Platform Links", content:"(Add your links in content.json)", actions:["Liquidity","Settings"] }
      };

      education = education && (education.quotes?.length || education.tips?.length || education.warnings?.length || education.checklist?.length)
        ? education
        : {
          quotes:[
            "Discipline beats hype. Every time.",
            "If you canâ€™t size it, you canâ€™t trade it."
          ],
          tips:[
            "Size down until your plan is automatic.",
            "If volume is dead, the chart lies."
          ],
          warnings:[
            "If youâ€™re emotional, youâ€™re exit liquidity.",
            "Chasing green candles is how accounts die."
          ],
          checklist:[
            "Liquidity checked",
            "Volume / MC reasonable",
            "Top holders not bundled",
            "Stop / TP planned before entry"
          ]
        };
    }

    // ============================================
    // STORAGE HELPERS
    // ============================================
    function loadJSON(key) {
      try { return JSON.parse(localStorage.getItem(key) || "null"); }
      catch { return null; }
    }
    function saveJSON(key, val) {
      try { localStorage.setItem(key, JSON.stringify(val)); } catch {}
    }

    // ============================================
    // FETCH CONTENT FROM JSON
    // ============================================
    async function loadContent() {
      try {
        const response = await fetch(CONTENT_URL, { cache: "no-store" });
        if (!response.ok) throw new Error('Failed to fetch');

        const data = await response.json();

        if (data.facts) facts = data.facts;
        if (data.knowledge) knowledgeBase = data.knowledge;
        if (data.education) education = data.education;

        applyFallbackContent();
        updateUIWithContent();

        console.log('âœ… Content loaded from JSON');
        document.getElementById('status-text').textContent = 'ONLINE';
        document.getElementById('doc-count').textContent = Object.keys(knowledgeBase).length;

        return true;
      } catch (error) {
        console.error('âŒ Failed to load content:', error);

        applyFallbackContent();
        updateUIWithContent();

        document.getElementById('status-text').textContent = 'OFFLINE';
        document.getElementById('doc-count').textContent = Object.keys(knowledgeBase).length;

        return false;
      }
    }

    function updateUIWithContent() {
      if (facts.traderUYoutube) document.getElementById('yt-link').href = facts.traderUYoutube;
      if (facts.traderUTikTok) document.getElementById('tt-link').href = facts.traderUTikTok;
      if (facts.traderUInstagram) document.getElementById('ig-link').href = facts.traderUInstagram;
    }

    function enterTerminal() {
      document.getElementById('welcome-screen').classList.add('hidden');
      document.getElementById('terminal-container').style.opacity = '1';
      document.getElementById('terminal-container').style.transition = 'opacity 0.5s ease';
      document.getElementById('data-feed').style.opacity = '1';
      document.getElementById('data-feed').style.transition = 'opacity 0.5s ease 0.3s';

      setTimeout(async () => {
        await loadContent();
        initTerminal();
        initNeuralNetwork();
        initBotChat();
        initMobileTabs();
        initTopBarBrainToggle();
      }, 500);
    }

    function triggerFlash() {
      const flash = document.getElementById('screen-flash');
      flash.classList.add('active');
      setTimeout(() => flash.classList.remove('active'), 300);
    }

    function hexToRgb(hex) {
      const h = (hex || "").replace("#", "").trim();
      if (h.length !== 6) return { r:255, g:149, b:0 };
      return {
        r: parseInt(h.slice(0,2), 16),
        g: parseInt(h.slice(2,4), 16),
        b: parseInt(h.slice(4,6), 16)
      };
    }
    function rgbToHex(r,g,b) {
      const toHex = (n) => Math.max(0, Math.min(255, Math.round(n))).toString(16).padStart(2, "0");
      return "#" + toHex(r) + toHex(g) + toHex(b);
    }
    function lighten(hex, amt=0.15) {
      const { r,g,b } = hexToRgb(hex);
      return rgbToHex(r + (255-r)*amt, g + (255-g)*amt, b + (255-b)*amt);
    }

    function changeTheme(color, element) {
      document.documentElement.style.setProperty('--accent', color);
      document.documentElement.style.setProperty('--accent-hover', lighten(color, 0.15));

      document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
      if (element) element.classList.add('active');
    }

    // ============================================
    // Mobile Tab Switcher
    // ============================================
    function initMobileTabs() {
      const tabs = document.getElementById('mobile-tabs');
      if (!tabs) return;

      const leftPanel = document.getElementById('left-panel');
      const centerPanel = document.getElementById('center-panel');
      const rightPanel = document.getElementById('right-panel');
      const commandInput = document.getElementById('command-input');
      const botInput = document.getElementById('bot-input');
      const botChat = document.getElementById('bot-chat');

      // default on mobile: brain
      centerPanel.classList.add('active');

      tabs.addEventListener('click', (e) => {
        const btn = e.target.closest('.mobile-tab');
        if (!btn) return;

        const view = btn.dataset.view;

        document.querySelectorAll('.mobile-tab').forEach(t => t.classList.remove('active'));
        leftPanel.classList.remove('active');
        centerPanel.classList.remove('active');
        rightPanel.classList.remove('active');

        btn.classList.add('active');

        if (view === 'terminal') {
          leftPanel.classList.add('active');
          setTimeout(() => commandInput && commandInput.focus(), 100);
        }
        if (view === 'brain') {
          centerPanel.classList.add('active');
        }
        if (view === 'bot') {
          rightPanel.classList.add('active');
          setTimeout(() => {
            botInput && botInput.focus();
            if (botChat) botChat.scrollTop = botChat.scrollHeight;
          }, 100);
        }
      });
    }

    // ============================================
    // Education Terminal
    // ============================================
    const commandOutput = document.getElementById('command-output');
    const commandInput = document.getElementById('command-input');

    function addCmd(text, type = '') {
      const line = document.createElement('div');
      line.className = `cmd-line ${type}`;
      line.innerHTML = text;
      commandOutput.appendChild(line);
      commandOutput.scrollTop = commandOutput.scrollHeight;
    }

    function initTerminal() {
      const docCount = Object.keys(knowledgeBase).length;
      addCmd('<span class="cmd-prompt">TRADER U></span> <span class="cmd-text">System initialized</span>');
      addCmd(`<span class="cmd-prompt">TRADER U></span> <span class="cmd-success">Knowledge base loaded: ${docCount} docs</span>`);
      addCmd('<span class="cmd-prompt">TRADER U></span> <span class="cmd-text">Type "help" for commands</span>');

      function fireContent() {
        const rand = Math.random();

        if (rand < 0.25 && education.quotes.length > 0) {
          const quote = education.quotes[Math.floor(Math.random() * education.quotes.length)];
          addCmd('<span class="cmd-text">' + quote + '</span>');
        } else if (rand < 0.5 && education.tips.length > 0) {
          const tip = education.tips[Math.floor(Math.random() * education.tips.length)];
          addCmd('<span class="cmd-success">' + tip + '</span>');
        } else if (rand < 0.7 && education.warnings.length > 0) {
          const warning = education.warnings[Math.floor(Math.random() * education.warnings.length)];
          addCmd('<span class="cmd-warning">' + warning + '</span>');
        } else if (education.checklist.length > 0) {
          addCmd('<span class="cmd-text">ðŸ“‹ PRE-TRADE CHECKLIST:</span>');
          education.checklist.forEach(item => addCmd('<span class="cmd-text">   â–¡ ' + item + '</span>'));
        }

        setTimeout(fireContent, 6000 + Math.random() * 6000);
      }

      setTimeout(fireContent, 3000);
    }

    const commands = {
      help: () => {
        addCmd('<span class="cmd-success">AVAILABLE COMMANDS:</span>');
        Object.keys(knowledgeBase).forEach(key => {
          const doc = knowledgeBase[key];
          addCmd(`<span class="cmd-text">  ${key} - ${doc.title}</span>`);
        });
        addCmd('<span class="cmd-text">  clear - Clear terminal</span>');
        addCmd('<span class="cmd-text">  brain - Toggle brain mode (orbit/sandbox)</span>');
        addCmd('<span class="cmd-text">  resetbrain - Clear saved brain layout</span>');
      },

      clear: () => {
        commandOutput.innerHTML = '';
        addCmd('<span class="cmd-prompt">TRADER U></span> <span class="cmd-text">Terminal cleared</span>');
      },

      brain: () => {
        toggleBrainMode(true);
      },

      resetbrain: () => {
        localStorage.removeItem(BRAIN_STORAGE_KEY);
        addCmd('<span class="cmd-success">Brain layout reset (reload page)</span>');
      }
    };

    function showInBot(key) {
      addCmd(`<span class="cmd-success">âœ“ Displaying "${key}" in bot chat</span>`);
      displayBotMessage(key);
    }

    // Dynamically add commands for each knowledge doc
    function setupCommands() {
      Object.keys(knowledgeBase).forEach(key => {
        commands[key] = () => showInBot(key);
      });

      // Aliases
      if (knowledgeBase.liquidity) commands.lp = () => showInBot('liquidity');
      if (knowledgeBase.referrals) {
        commands.links = () => showInBot('referrals');
        commands.axiom = () => showInBot('referrals');
      }
    }

    commandInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        const cmd = commandInput.value.trim().toLowerCase();
        if (cmd) {
          addCmd(`<span class="cmd-prompt">TRADER U></span> ${cmd}`);
          if (commands[cmd]) commands[cmd]();
          else addCmd('<span class="cmd-warning">Command not found. Type "help"</span>');
        }
        commandInput.value = '';
      }
    });

    // ============================================
    // Brain Mode Toggle (top title click)
    // ============================================
    function loadBrainState() {
      const st = loadJSON(BRAIN_STORAGE_KEY);
      if (st && st.mode) BRAIN_MODE = st.mode;
      return st;
    }
    function saveBrainState(state) { saveJSON(BRAIN_STORAGE_KEY, state); }

    function toggleBrainMode(logToTerminal=false) {
      BRAIN_MODE = (BRAIN_MODE === "sandbox") ? "orbit" : "sandbox";
      const st = loadJSON(BRAIN_STORAGE_KEY) || { nodes: {} };
      st.mode = BRAIN_MODE;
      saveBrainState(st);
      triggerFlash();
      if (logToTerminal) addCmd(`<span class="cmd-success">Brain mode: ${BRAIN_MODE.toUpperCase()}</span>`);
      const status = document.getElementById('status-text');
      if (status) status.textContent = (document.getElementById('status-text').textContent === "ONLINE" || document.getElementById('status-text').textContent === "OFFLINE")
        ? document.getElementById('status-text').textContent
        : "ONLINE";
    }

    function initTopBarBrainToggle() {
      const title = document.querySelector('.terminal-title');
      if (!title) return;
      title.addEventListener('click', () => toggleBrainMode(true));

      // restore saved mode on init
      const st = loadBrainState();
      if (st && st.mode && st.mode !== BRAIN_MODE) BRAIN_MODE = st.mode;
      addCmd(`<span class="cmd-text">Brain mode loaded: <span class="cmd-success">${BRAIN_MODE.toUpperCase()}</span></span>`);
    }

    // ============================================
    // Neural Network (Orbit + Sandbox + Saved Layout)
    // ============================================
    function initNeuralNetwork() {
      const neuralArea = document.getElementById('neural-network');
      neuralArea.innerHTML = ""; // clean

      function getAreaDimensions() {
        const rect = neuralArea.getBoundingClientRect();
        return {
          width: rect.width,
          height: rect.height - 140,
          centerX: rect.width / 2,
          centerY: (rect.height - 140) / 2
        };
      }

      let dims = getAreaDimensions();

      const nodes = [];
      let draggedNode = null;
      let isDragging = false;
      let dragOffset = { x: 0, y: 0 };

      function getRadiusScale() {
        return Math.min(dims.width, dims.height) / 600;
      }

      // Restore saved mode and node positions
      const saved = loadBrainState() || { mode: BRAIN_MODE, nodes: {} };
      if (saved.mode) BRAIN_MODE = saved.mode;
      if (!saved.nodes) saved.nodes = {};

      function markSandboxByLabel(nodeObj) {
        const label = (nodeObj.element.textContent || "").trim();
        const entry = saved.nodes[label];
        if (entry && typeof entry.x === "number" && typeof entry.y === "number") {
          nodeObj.isSandbox = true;
          nodeObj.sandboxX = entry.x;
          nodeObj.sandboxY = entry.y;
          nodeObj.x = entry.x;
          nodeObj.y = entry.y;

          const size = nodeObj.layer === 'core' ? 35 : 25;
          nodeObj.element.style.left = (nodeObj.x - size) + 'px';
          nodeObj.element.style.top  = (nodeObj.y - size) + 'px';
        }
      }

      // CORE NODES
      const coreLabels = ['ANALYSIS', 'MEMORY', 'DECISION'];
      for (let i = 0; i < 3; i++) {
        const angle = (i / 3) * Math.PI * 2 - Math.PI / 2;
        const radius = 80 * getRadiusScale();
        const x = Math.cos(angle) * radius + dims.centerX;
        const y = Math.sin(angle) * radius + dims.centerY;

        const node = document.createElement('div');
        node.className = 'neural-node core active';
        node.style.left = (x - 35) + 'px';
        node.style.top  = (y - 35) + 'px';
        node.textContent = coreLabels[i];

        neuralArea.appendChild(node);

        const obj = {
          element: node,
          x, y,
          angle,
          radius,
          layer: 'core',
          isDraggable: true,
          baseRadius: 80,
          isSandbox: false,
          sandboxX: null,
          sandboxY: null
        };

        nodes.push(obj);
      }

      // INNER RING
      const innerLabels = ['RUG DETECT', 'RISK MGT', 'CHART', 'VOLUME', 'WALLET', 'FILTER', 'ENTRY', 'EXIT'];
      for (let i = 0; i < 8; i++) {
        const angle = (i / 8) * Math.PI * 2 - Math.PI / 2;
        const radius = 160 * getRadiusScale();
        const x = Math.cos(angle) * radius + dims.centerX;
        const y = Math.sin(angle) * radius + dims.centerY;

        const node = document.createElement('div');
        node.className = 'neural-node';
        if (i % 2 === 0) node.classList.add('active');
        node.style.left = (x - 25) + 'px';
        node.style.top  = (y - 25) + 'px';
        node.textContent = innerLabels[i];

        neuralArea.appendChild(node);

        nodes.push({
          element: node,
          x, y,
          angle,
          radius,
          layer: 'inner',
          isDraggable: true,
          baseRadius: 160,
          isSandbox: false,
          sandboxX: null,
          sandboxY: null
        });
      }

      // OUTER RING
      const outerLabels = ['SIGNAL', 'PATTERN', 'SENTIMENT', 'LIQUIDITY', 'TIMING', 'NARRATIVE', 'EXECUTE', 'LEARN'];
      for (let i = 0; i < 8; i++) {
        const angle = (i / 8) * Math.PI * 2;
        const radius = 240 * getRadiusScale();
        const x = Math.cos(angle) * radius + dims.centerX;
        const y = Math.sin(angle) * radius + dims.centerY;

        const node = document.createElement('div');
        node.className = 'neural-node';
        if (i % 3 === 0) node.classList.add('active');
        node.style.left = (x - 25) + 'px';
        node.style.top  = (y - 25) + 'px';
        node.textContent = outerLabels[i];

        neuralArea.appendChild(node);

        nodes.push({
          element: node,
          x, y,
          angle,
          radius,
          layer: 'outer',
          isDraggable: true,
          baseRadius: 240,
          isSandbox: false,
          sandboxX: null,
          sandboxY: null
        });
      }

      // Apply saved sandbox positions (if any)
      nodes.forEach(markSandboxByLabel);

      // Synapses
      const synapses = [];
      function makeSynapse(a, b, isCore = false) {
        const syn = document.createElement('div');
        syn.className = isCore ? 'synapse core-connection' : 'synapse';
        if (Math.random() > 0.6) syn.classList.add('firing');
        neuralArea.insertBefore(syn, neuralArea.firstChild);
        synapses.push({ el: syn, a, b });
      }

      // CORE TO CORE
      for (let i = 0; i < 3; i++) makeSynapse(i, (i + 1) % 3, true);

      // CORE TO INNER
      for (let i = 0; i < 3; i++) {
        for (let j = 3; j < 11; j += 2) makeSynapse(i, j, true);
      }

      // INNER RING
      for (let i = 3; i < 11; i++) {
        makeSynapse(i, 3 + ((i - 3 + 1) % 8));
        if (i % 2 === 0) makeSynapse(i, 3 + ((i - 3 + 2) % 8));
      }

      // INNER TO OUTER
      for (let i = 3; i < 11; i++) {
        const outerIdx = 11 + (i - 3);
        makeSynapse(i, outerIdx);
      }

      // OUTER RING
      for (let i = 11; i < 19; i++) makeSynapse(i, 11 + ((i - 11 + 1) % 8));

      // Cross connections
      makeSynapse(3, 15);
      makeSynapse(5, 17);
      makeSynapse(7, 13);
      makeSynapse(9, 18);

      document.getElementById('synapse-count').textContent = synapses.length;

      function updateSynapses() {
        synapses.forEach(s => {
          const n1 = nodes[s.a];
          const n2 = nodes[s.b];
          const dx = n2.x - n1.x;
          const dy = n2.y - n1.y;
          const dist = Math.sqrt(dx*dx + dy*dy);
          const ang = Math.atan2(dy, dx);
          s.el.style.width = dist + 'px';
          s.el.style.left = n1.x + 'px';
          s.el.style.top  = n1.y + 'px';
          s.el.style.transform = `rotate(${ang}rad)`;
        });
      }

      // ===== Pointer-based Drag (mouse + touch)
      let pointerId = null;

      nodes.forEach((nodeObj) => {
        nodeObj.element.addEventListener('pointerdown', (e) => {
          e.preventDefault();
          pointerId = e.pointerId;
          isDragging = true;
          draggedNode = nodeObj;
          nodeObj.element.setPointerCapture(pointerId);

          const rect = nodeObj.element.getBoundingClientRect();
          dragOffset.x = e.clientX - rect.left - rect.width / 2;
          dragOffset.y = e.clientY - rect.top  - rect.height / 2;

          nodeObj.element.classList.add('dragging');
        });
      });

      neuralArea.addEventListener('pointermove', (e) => {
        if (!isDragging || !draggedNode || e.pointerId !== pointerId) return;

        const rect = neuralArea.getBoundingClientRect();
        const newX = e.clientX - rect.left - dragOffset.x;
        const newY = e.clientY - rect.top  - dragOffset.y;

        draggedNode.x = newX;
        draggedNode.y = newY;

        const size = draggedNode.layer === 'core' ? 35 : 25;
        draggedNode.element.style.left = (newX - size) + 'px';
        draggedNode.element.style.top  = (newY - size) + 'px';

        updateSynapses();
      });

      function endDrag(e) {
        if (!isDragging || !draggedNode) return;
        if (e && pointerId !== null && e.pointerId !== pointerId) return;

        draggedNode.element.classList.remove('dragging');

        const label = (draggedNode.element.textContent || "").trim();

        if (BRAIN_MODE === "sandbox") {
          draggedNode.isSandbox = true;
          draggedNode.sandboxX = draggedNode.x;
          draggedNode.sandboxY = draggedNode.y;

          const st = loadJSON(BRAIN_STORAGE_KEY) || { mode: BRAIN_MODE, nodes: {} };
          st.mode = BRAIN_MODE;
          st.nodes ||= {};
          st.nodes[label] = { x: draggedNode.sandboxX, y: draggedNode.sandboxY };
          saveBrainState(st);
        } else {
          // orbit mode: snap back by clearing sandbox flag (animation resumes orbit)
          draggedNode.isSandbox = false;
          draggedNode.sandboxX = null;
          draggedNode.sandboxY = null;
        }

        isDragging = false;
        draggedNode = null;
        pointerId = null;
      }

      neuralArea.addEventListener('pointerup', endDrag);
      neuralArea.addEventListener('pointercancel', endDrag);
      document.addEventListener('pointerup', endDrag);

      // ===== Animation (respects sandbox nodes)
      function animateNodes() {
        dims = getAreaDimensions();
        const scale = getRadiusScale();

        nodes.forEach((nodeObj) => {
          // If sandbox + sandbox-mode => keep fixed
          if (BRAIN_MODE === "sandbox" && nodeObj.isSandbox) {
            nodeObj.x = nodeObj.sandboxX;
            nodeObj.y = nodeObj.sandboxY;
            const size = nodeObj.layer === 'core' ? 35 : 25;
            nodeObj.element.style.left = (nodeObj.x - size) + 'px';
            nodeObj.element.style.top  = (nodeObj.y - size) + 'px';
            return;
          }

          // If currently dragging => keep as-is
          if (isDragging && draggedNode === nodeObj) return;

          // Orbit update
          if (nodeObj.layer !== 'core') {
            nodeObj.angle += (nodeObj.layer === 'inner' ? 0.0015 : 0.001);
            nodeObj.radius = nodeObj.baseRadius * scale;
            const x = Math.cos(nodeObj.angle) * nodeObj.radius + dims.centerX;
            const y = Math.sin(nodeObj.angle) * nodeObj.radius + dims.centerY;
            nodeObj.element.style.left = (x - 25) + 'px';
            nodeObj.element.style.top  = (y - 25) + 'px';
            nodeObj.x = x;
            nodeObj.y = y;
          } else {
            nodeObj.radius = nodeObj.baseRadius * scale;
            const x = Math.cos(nodeObj.angle) * nodeObj.radius + dims.centerX;
            const y = Math.sin(nodeObj.angle) * nodeObj.radius + dims.centerY;
            nodeObj.element.style.left = (x - 35) + 'px';
            nodeObj.element.style.top  = (y - 35) + 'px';
            nodeObj.x = x;
            nodeObj.y = y;
          }
        });

        updateSynapses();
        requestAnimationFrame(animateNodes);
      }

      animateNodes();

      // Synapse firing pulses
      setInterval(() => {
        if (Math.random() > 0.5) {
          const count = 5 + Math.floor(Math.random() * 8);
          for (let i = 0; i < count; i++) {
            const idx = Math.floor(Math.random() * synapses.length);
            synapses[idx].el.classList.add('firing');
            setTimeout(() => synapses[idx].el.classList.remove('firing'), 1500);
          }
        }
      }, 2000);

      window.addEventListener('resize', () => { dims = getAreaDimensions(); });
    }

    // ============================================
    // Bot Chat
    // ============================================
    const botChat = document.getElementById('bot-chat');

    function addBotMessage(html, actions = []) {
      const msg = document.createElement('div');
      msg.className = 'bot-message';
      msg.innerHTML = html;

      if (actions.length > 0) {
        const actionsDiv = document.createElement('div');
        actionsDiv.className = 'message-actions';
        actions.forEach(action => {
          const btn = document.createElement('button');
          btn.className = 'action-btn';
          btn.textContent = action;
          btn.onclick = () => handleAction(action);
          actionsDiv.appendChild(btn);
        });
        msg.appendChild(actionsDiv);
      }

      botChat.appendChild(msg);
      botChat.scrollTop = botChat.scrollHeight;
    }

    function displayBotMessage(key) {
      const doc = knowledgeBase[key];
      if (!doc) return;

      let html = `<strong>${doc.title}</strong><br><br>${(doc.content || "").replace(/\n/g, '<br>')}`;

      // Optional: referral link injection if you use content.json facts for these keys
      if (key === 'referrals' && facts.axiomReferral) {
        html = html.replace('Best for beginners',
          `<a href="${facts.axiomReferral}" target="_blank" style="color:var(--accent);">${facts.axiomReferral}</a><br>Best for beginners`);
        if (facts.novaReferral) {
          html = html.replace('25% fee cashback',
            `<a href="${facts.novaReferral}" target="_blank" style="color:var(--accent);">${facts.novaReferral}</a><br>25% fee cashback`);
        }
        if (facts.padreReferral) {
          html = html.replace('Advanced terminal',
            `<a href="${facts.padreReferral}" target="_blank" style="color:var(--accent);">${facts.padreReferral}</a><br>Advanced terminal`);
        }
      }

      if (doc.images && doc.images.length > 0) {
        doc.images.forEach(img => { html += `<br><img src="${img}" alt="Guide">`; });
      }

      addBotMessage(html, doc.actions || []);
    }

    // ============================================
    // LIGHTWEIGHT "LEARN" (not real AI)
    // counts topics asked; suggests top topics
    // ============================================
    function bumpTopic(topicKey) {
      const st = loadJSON(STATS_STORAGE_KEY) || { topics: {} };
      st.topics ||= {};
      st.topics[topicKey] = (st.topics[topicKey] || 0) + 1;
      saveJSON(STATS_STORAGE_KEY, st);
    }

    function topTopics(n = 3) {
      const st = loadJSON(STATS_STORAGE_KEY) || { topics: {} };
      const entries = Object.entries(st.topics || {});
      entries.sort((a,b) => b[1] - a[1]);
      return entries.slice(0, n).map(([k]) => k);
    }

    function handleAction(action) {
      const map = {
        'Good coin signs': 'goodcoin',
        'Good coin checklist': 'goodcoin',
        'Good coins': 'goodcoin',
        'Rug detection': 'rugpull',
        'Rug signs': 'rugpull',
        'Spot rugs': 'rugpull',
        'Risk management': 'risk',
        'Risk mgmt': 'risk',
        'Risk rules': 'risk',
        'Show filters': 'filters',
        'Filters': 'filters',
        'Entry tips': 'workflow',
        'Workflow': 'workflow',
        'Study trades': 'risk',
        'CA explanation': 'ca',
        'Settings': 'settings',
        'Bundle detection': 'bundles',
        'Volume check': 'volume',
        'Liquidity': 'liquidity',
        'LP locks': 'liquidity',
        'Platform links': 'referrals',
        'Referrals': 'referrals'
      };

      const key = map[action];
      if (key && knowledgeBase[key]) {
        bumpTopic(key);
        displayBotMessage(key);

        setTimeout(() => {
          const messages = botChat.querySelectorAll('.bot-message');
          const lastMsg = messages[messages.length - 1];
          if (lastMsg) lastMsg.scrollIntoView({ behavior:'smooth', block:'start' });
        }, 100);
      }
    }

    function initBotChat() {
      setupCommands();

      // show saved mode in bot on first load
      const st = loadBrainState() || { mode: BRAIN_MODE };
      if (st.mode) BRAIN_MODE = st.mode;

      const suggested = topTopics(3).filter(k => knowledgeBase[k]).slice(0,3);
      const actions = suggested.length ? suggested.map(k => knowledgeBase[k].title) : ['Rug detection','Liquidity','Platform links'];

      const welcome =
        `ðŸŽ“ <strong>Welcome to TRADER U!</strong><br><br>` +
        `A community of dedicated traders learning together.<br><br>` +
        `Brain Mode: <strong>${BRAIN_MODE.toUpperCase()}</strong><br>` +
        `Tip: Click the title to toggle Orbit/Sandbox.<br><br>` +
        `What do you want to learn?`;

      addBotMessage(welcome, ['Rug detection', 'Liquidity', 'Platform links']);
    }

    // Bot input handlers
    const botInput = document.getElementById('bot-input');
    const botSend  = document.getElementById('bot-send');

    function sendBotQuery() {
      const query = botInput.value.trim();
      if (!query) return;

      // user bubble
      const userMsg = document.createElement('div');
      userMsg.className = 'bot-message';
      userMsg.style.borderLeftColor = '#00ff00';
      userMsg.style.alignSelf = 'flex-end';
      userMsg.style.maxWidth = '85%';
      userMsg.textContent = query;
      botChat.appendChild(userMsg);

      setTimeout(() => userMsg.scrollIntoView({ behavior:'smooth', block:'start' }), 100);

      botInput.value = '';

      setTimeout(() => {
        const lower = query.toLowerCase();
        let foundKey = null;

        // keyword in KB keys / titles
        for (const key in knowledgeBase) {
          const title = (knowledgeBase[key].title || "").toLowerCase();
          if (lower.includes(key) || (title && lower.includes(title))) {
            foundKey = key;
            break;
          }
        }

        // fallback matching
        if (!foundKey) {
          if (lower.includes('rug')) foundKey = 'rugpull';
          else if (lower.includes('good') || lower.includes('find')) foundKey = 'goodcoin';
          else if (lower.includes('risk') || lower.includes('stop') || lower.includes('sl')) foundKey = 'risk';
          else if (lower.includes('filter')) foundKey = 'filters';
          else if (lower.includes('ape') || lower.includes('scan') || lower.includes('watch')) foundKey = 'workflow';
          else if (lower.includes('ca') || lower.includes('contract')) foundKey = 'ca';
          else if (lower.includes('setting') || lower.includes('buy') || lower.includes('sell')) foundKey = 'settings';
          else if (lower.includes('bundle')) foundKey = 'bundles';
          else if (lower.includes('volume')) foundKey = 'volume';
          else if (lower.includes('liq') || lower.includes('lp') || lower.includes('lock')) foundKey = 'liquidity';
          else if (lower.includes('refer') || lower.includes('link') || lower.includes('axiom') || lower.includes('nova')) foundKey = 'referrals';
          else if (lower.includes('brain') || lower.includes('orbit') || lower.includes('sandbox')) {
            toggleBrainMode(false);
            addBotMessage(`Brain mode is now <strong>${BRAIN_MODE.toUpperCase()}</strong>.`, []);
            return;
          }
        }

        if (foundKey && knowledgeBase[foundKey]) {
          bumpTopic(foundKey);
          displayBotMessage(foundKey);
        } else {
          let response = `I can help with that. Available topics:<br><br>`;
          Object.keys(knowledgeBase).forEach(key => {
            response += `â€¢ <strong>${knowledgeBase[key].title}</strong><br>`;
          });
          response += `<br>Try terminal commands too: <strong>help</strong>`;
          addBotMessage(response, ['Rug detection', 'Risk rules', 'Liquidity']);
        }
      }, 450);
    }

    botSend.addEventListener('click', sendBotQuery);
    botInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendBotQuery();
    });

    // ============================================
    // Live Data Feed
    // ============================================
    function updateDataFeed() {
      const feeds = [
        { label:'BTC', base:95284, variance:500 },
        { label:'ETH', base:3421, variance:50 },
        { label:'SOL', base:147, variance:5 },
        { label:'MCAP', base:3.2, variance:0.1, suffix:'T' },
        { label:'24H VOL', base:127, variance:5, suffix:'B' }
      ];

      const feedItems = document.querySelectorAll('.feed-item');

      feeds.forEach((feed, idx) => {
        const item = feedItems[idx];
        if (!item) return;

        const change = (Math.random() - 0.5) * feed.variance * 2;
        const newValue = feed.base + change;
        const formatted = feed.suffix
          ? `$${newValue.toFixed(1)}${feed.suffix}`
          : `$${Math.floor(newValue).toLocaleString()}`;

        const valueSpan = item.querySelector('.feed-value');
        if (valueSpan) {
          valueSpan.style.transition = 'none';
          valueSpan.style.color = change > 0 ? '#00ff00' : '#ff3333';
          valueSpan.textContent = formatted;

          setTimeout(() => {
            valueSpan.style.transition = 'color 0.5s ease';
            valueSpan.style.color = '#00ff00';
          }, 100);
        }
      });
    }
    setInterval(updateDataFeed, 2000 + Math.random() * 2000);
  </script>
</body>
</html>
